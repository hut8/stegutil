C Steganography Utility - Encoding Routines
C Liam Bowen [bowenl2@cs.rpi.edu]
      IMPLICIT NONE
      
      SUBROUTINE STEGO_ENCODE(PAYLOAD_FN,CARRIER_FN,PAD_FN,PACKAGE_FN)
      INTEGER*4 ARGC, ERRNO
C     Subroutine Parameters
      CHARACTER*255, INTENT(IN) :: PAYLOAD_FN, CARRIER_FN, PACKAGE_FN
      CHARACTER*255, INTENT(IN), OPTIONAL PAD_FN
      LOGICAL*4 PADDING
C     Data Lengths
      INTEGER*4 INFO(13), PAYLOAD_LEN, PAD_LEN
C     Unit Declarations
      INTEGER*4 PAYLOAD_UNIT, CARRIER_UNIT,
     ;PACKAGE_UNIT, PAD_UNIT

C     Unit Aliases
      PARAMETER(PAYLOAD_UNIT=50, CARRIER_UNIT=51,
     ;PACKAGE_UNIT=52, PAD_UNIT=53)

      OPEN(UNIT=PAYLOAD_UNIT,FILE=PAYLOAD_FN, STATUS='OLD')
      OPEN(UNIT=CARRIER_UNIT,FILE=CARRIER_FN, STATUS="OLD")
      IF (PRESENT(PAD_FN)) THEN
         OPEN(UNIT=PAD_UNIT,FILE=PAD_FN, STATUS="OLD")
      END IF
      OPEN(UNIT=PACKAGE_UNIT,FILE=PACKAGE_FN, STATUS="NEW")


C     Enforce sizes of input units
C     Plaintext length (all values valid)
 901  FORMAT('Plaintext Length: ', I11, 'B')
      RC=FSTAT(1,INFO)
      PLAINTEXT_LEN=INFO(8)
      WRITE(6, 901) PLAINTEXT_LEN
C     Padding length (must be at least as large as plaintext)
      IF (USE_PAD) THEN
 902     FORMAT('Padding Length: ', I11, 'B')
         RC=FSTAT(4,INFO)
         PAD_LEN=INFO(8)
         WRITE(6,902) PAD_LEN
         IF (PAD_LEN.LT.PLAINTEXT_LEN) THEN
            PRINT *,'Fatal error: a pad, if given, must
     ;be at least as long as plaintext'
            STOP
         END IF
      END IF   
      END
